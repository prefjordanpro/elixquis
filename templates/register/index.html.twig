{% extends 'base.html.twig' %}


{% block body %}
<div class="container my-5">
<div class="row justify-content-center">
<div class="col-md-8 col-lg-6">

    {% form_theme registerForm 'bootstrap_5_layout.html.twig' %}

    <div class="card shadow-sm border-1">
    <div class="card-body p-4 p-lg-5">
        <h1 class="h3 mb-3">Inscription</h1>

        {{ form_start(registerForm) }}

        {# Ligne pr√©nom/nom si ces champs existent #}
        {% if registerForm.firstname is defined or registerForm.lastname is defined %}
            <div class="row g-3">
            {% if registerForm.firstname is defined %}
                <div class="col-md-6">
                {{ form_row(registerForm.firstname, {
                    label: 'Pr√©nom',
                    attr: { placeholder: 'Votre pr√©nom' }
                }) }}
                </div>
            {% endif %}
            {% if registerForm.lastname is defined %}
                <div class="col-md-6">
                {{ form_row(registerForm.lastname, {
                    label: 'Nom',
                    attr: { placeholder: 'Votre nom' }
                }) }}
                </div>
            {% endif %}
            </div>
        {% endif %}

        {# Email #}
        {% if registerForm.email is defined %}
            {{ form_row(registerForm.email, {
            label: 'Email',
            attr: { placeholder: 'nom@domaine.fr' }
            }) }}
        {% endif %}

        {# Mot de passe (RepeatedType ou simple) #}
        {# Mot de passe (RepeatedType ou simple) #}
        {% if registerForm.plainPassword is defined %}
        {% if registerForm.plainPassword.first is defined %}
            {# --- Champ 1 --- #}
            <div class="mb-3">
            {{ form_label(registerForm.plainPassword.first, 'Mot de passe', { label_attr: { class: 'form-label' } }) }}
            <div class="input-group">
                <span class="input-group-text"><i data-feather="lock"></i></span>
                {{ form_widget(registerForm.plainPassword.first, { attr: { class: 'form-control' } }) }}
                <button class="btn btn-outline-secondary js-pwd-toggle" type="button"
                        data-target="#{{ registerForm.plainPassword.first.vars.id }}"
                        aria-label="Afficher/Masquer le mot de passe">
                <span class="pwd-icon"></span>
                </button>
            </div>
            {{ form_errors(registerForm.plainPassword.first) }}
            </div>

            {# --- Champ 2 (confirmation) --- #}
            <div class="mb-3">
            {{ form_label(registerForm.plainPassword.second, 'Confirmer le mot de passe', { label_attr: { class: 'form-label' } }) }}
            <div class="input-group">
                <span class="input-group-text"><i data-feather="lock"></i></span>
                {{ form_widget(registerForm.plainPassword.second, { attr: { class: 'form-control' } }) }}
                <button class="btn btn-outline-secondary js-pwd-toggle" type="button"
                        data-target="#{{ registerForm.plainPassword.second.vars.id }}"
                        aria-label="Afficher/Masquer le mot de passe">
                <span class="pwd-icon"></span>
                </button>
            </div>
            {{ form_errors(registerForm.plainPassword.second) }}
            </div>
        {% else %}
            {# --- Champ unique --- #}
            <div class="mb-3">
            {{ form_label(registerForm.plainPassword, 'Mot de passe', { label_attr: { class: 'form-label' } }) }}
            <div class="input-group">
                <span class="input-group-text"><i data-feather="lock"></i></span>
                {{ form_widget(registerForm.plainPassword, { attr: { class: 'form-control' } }) }}
                <button class="btn btn-outline-secondary js-pwd-toggle" type="button"
                        data-target="#{{ registerForm.plainPassword.vars.id }}"
                        aria-label="Afficher/Masquer le mot de passe">
                <span class="pwd-icon"></span>
                </button>
            </div>
            {{ form_errors(registerForm.plainPassword) }}
            </div>
        {% endif %}
        {% endif %}


        {# CGU/CGV / consentement si pr√©sent #}
        {% if registerForm.agreeTerms is defined %}
            <div class="form-check my-3">
            {{ form_widget(registerForm.agreeTerms, { attr: { class: 'form-check-input' } }) }}
            {{ form_label(registerForm.agreeTerms, 'J‚Äôaccepte les conditions', { label_attr: { class: 'form-check-label' } }) }}
            {{ form_errors(registerForm.agreeTerms) }}
            </div>
        {% endif %}

        {# IMPORTANT : on rend le token CSRF, puis on bloque le rendu automatique du reste #}
        {{ form_row(registerForm._token) }}

        <div class="d-grid mt-3">
            <button type="submit" class="btn btn-success btn-lg">Cr√©er mon compte</button>
        </div>

        {{ form_end(registerForm, { render_rest: false }) }}


        <script>
        document.addEventListener('DOMContentLoaded', function () {
        const toggles = document.querySelectorAll('.js-pwd-toggle');

        function setIcon(holder, name) {
            if (window.feather && feather.icons && feather.icons[name]) {
            holder.innerHTML = feather.icons[name].toSvg();
            } else {
            holder.textContent = (name === 'eye') ? 'üëÅÔ∏è' : 'üôà';
            }
        }

        toggles.forEach(btn => {
            const targetSel = btn.getAttribute('data-target');
            const input = document.querySelector(targetSel);
            const iconHolder = btn.querySelector('.pwd-icon');
            if (!input || !iconHolder) return;

            // Ic√¥ne initiale
            setIcon(iconHolder, 'eye');

            btn.addEventListener('click', () => {
            const show = (input.type === 'password');
            input.type = show ? 'text' : 'password';
            setIcon(iconHolder, show ? 'eye-off' : 'eye');
            });
        });
        });
        </script>
        <hr class="my-4">

        <p class="mb-0 text-center">
        Vous avez d√©j√† un compte ?
        <a href="{{ path('app_login') }}">Connectez-vous</a>
        </p>
    </div>
    </div>

</div>
</div>
</div>
{% endblock %}
